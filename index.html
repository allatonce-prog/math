<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Step-by-Step Math Tutor</title>
    <meta name="description"
        content="A PWA Math Tutor for kids. Learn Multiplication and Division with visual steps and voice narration.">
    <meta name="theme-color" content="#4a90e2">

    <!-- iOS Support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Math Tutor">
    <link rel="apple-touch-icon" href="./assets/icon-192.png">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">

    <link rel="manifest" href="./manifest.json">
    <link rel="stylesheet" href="./css/styles.css">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚ûó</text></svg>">
</head>

<body>

    <header>
        <h1>JOHN PAUL SOLAYAO</h1>
        <button id="install-btn" class="hidden" aria-label="Install App">Install App</button>
    </header>

    <main>
        <section id="input-section" class="card">
            <h2>Let's Learn!</h2>
            <div class="input-group">
                <input type="number" id="num-a" placeholder="First Number (A)" min="1" max="20">
                <select id="operation" aria-label="Choose operation">
                    <option value="multiply">Multiply (√ó)</option>
                    <option value="divide">Divide (√∑)</option>
                </select>
                <input type="number" id="num-b" placeholder="Second Number (B)" min="1" max="20">

                <div class="voice-control">
                    <label for="voice-select">Microphone:</label>
                    <select id="voice-select" aria-label="Choose voice">
                        <option value="female">üë© Female Voice</option>
                        <option value="male">üë® Male Voice</option>
                    </select>
                </div>
            </div>
            <button id="solve-btn" class="primary-btn">Show Me How</button>
        </section>

        <section id="explanation-section" class="hidden">
            <div class="progress-container">
                <div id="progress-bar"></div>
            </div>

            <div id="step-stage">
                <!-- Content goes here -->
            </div>

            <div class="controls-area">
                <button id="prev-btn" class="nav-btn" disabled>‚¨ÖÔ∏è Back</button>
                <button id="replay-voice-btn" class="nav-btn secondary-btn" aria-label="Replay Audio">üîä Hear
                    it</button>
                <button id="next-btn" class="nav-btn primary-btn">Next ‚û°Ô∏è</button>
            </div>
        </section>
    </main>

    <footer>
        <p>sample pani mga idol</p>
    </footer>

    <!-- Custom Update Notification Toast -->
    <div id="update-toast">
        <span>New version available!</span>
        <button id="reload-btn">Update Now</button>
    </div>

    <!-- Service Worker Registration & Version Manager -->
    <script>
        let newWorker;

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js').then(reg => {
                    console.log('Service Worker registered!', reg.scope);

                    // clear old cache on load if needed or just rely on activation

                    reg.addEventListener('updatefound', () => {
                        newWorker = reg.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed') {
                                if (navigator.serviceWorker.controller) {
                                    // New update available
                                    showUpdateToast();
                                }
                            }
                        });
                    });
                }).catch(err => console.error('Service Worker registration failed:', err));
            });

            // Reload page when the new service worker takes control
            let refreshing;
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                if (refreshing) return;
                window.location.reload();
                refreshing = true;
            });
        }

        function showUpdateToast() {
            const toast = document.getElementById('update-toast');
            toast.classList.add('show');

            document.getElementById('reload-btn').addEventListener('click', () => {
                if (newWorker) {
                    newWorker.postMessage({ type: 'SKIP_WAITING' });
                }
            });
        }
    </script>

    <!-- Main Application Logic -->
    <script type="module" src="./js/main.js"></script>
</body>

</html>